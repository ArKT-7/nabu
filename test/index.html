<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../dist/zip-full.min.js"></script>
    <meta property="og:title" content="Web Fastboot Flasher by ArKT" />
    <meta property="og:description" content="It flash complete ROM or any images in any partition" />
    <meta property="og:url" content="https://arkt-7.github.io/nabu/test" />
    <meta property="og:type" content="website" />
    <meta name="description" content="It flash complete ROM or any images in any partition' />
    <meta name="title" content="Web Fastboot Flasher for flashing ROMS/Images" />
    <title>Web Fastboot Flasher by ArKT</title>
    <link rel="icon" href="https://img.icons8.com/fluency/48/android.png" type="image/png">
    <style id="light">
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f0f0f0, #d4e0e5);
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            min-height: 100vh;
            background-color: #f0f0f0;
        }

        h1 {
            color: #333333;
            text-align: center;
            margin-bottom: 20px;
            font-size: 38px;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.2);
        }

        h2 {
            color: #333333;
            margin-top: 0;
            margin-bottom: 5px;
            font-size: 24px;
            letter-spacing: 2px;
            background: linear-gradient(135deg, #007bff, #003b80);
            -webkit-background-clip: text;
            color: transparent;
            animation: textGlow 4s ease-in-out infinite;
        }

        .subtitle {
            color: #333333;
            text-align: center;
            font-size: 24px;
            margin-top: -5px;
        }

        @keyframes textGlow {
            0%, 100% {
                text-shadow: 
                    0 0 8px rgba(0, 123, 255, 0.6),
                    0 0 16px rgba(0, 123, 255, 0.4);
            }
            50% {
                text-shadow: 
                    0 0 12px rgba(0, 123, 255, 0.6),
                    0 0 20px rgba(0, 123, 255, 0.4);
            }
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            margin: 30px 0;
            background: linear-gradient(135deg, #e0e6ed, #c8d0d8);
            background-size: 200% 200%;
            border-radius: 20px;
            position: relative;
            text-align: center;
            overflow: hidden;
            animation: backgroundMove 20s linear infinite;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .container::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #ff9ecf, #a0b9ff, #d1e3ff, #ff9ecf);
            background-size: 400% 400%;
            border-radius: 20px;
            z-index: -1;
            filter: blur(10px);
            opacity: 0.8;
            animation: glow 10s ease infinite;
            box-shadow: 
                0 0 20px 10px rgba(255, 158, 207, 0.3),
                0 0 40px 10px rgba(255, 158, 207, 0.2) inset,
                -10px -10px 30px rgba(255, 158, 207, 0.5),
                10px -10px 30px rgba(255, 158, 207, 0.5),
                -10px 10px 30px rgba(255, 158, 207, 0.5),
                10px 10px 30px rgba(255, 158, 207, 0.5);
        }

        input[type="file"],
        input[type="text"],
        select {
            text-align: center; 
            width: 100%; 
            max-width: 600px; 
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 20px;
            border: none;
            box-sizing: border-box; 
            background: linear-gradient(135deg, #f0f4f8, #e2e8f0); 
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.08); 
            transition: all 0.3s ease;
            -webkit-appearance: none; 
            -moz-appearance: none; 
            appearance: none; 
            font-size: 14px;
            font-weight: bold;
            color: #333; 
        }

        pre.result-field {
            background: linear-gradient(135deg, #f0f4f8, #e2e8f0); 
            padding: 20px 20px 20px; 
            border-radius: 15px;
            overflow-y: auto; 
            overflow-x: hidden;
            max-height: 200px; 
            border: 1px solid #ccc;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 90%; 
            margin-top: 0; 
            position: relative; 
            color: black;
            white-space: pre-wrap;
            word-wrap: break-word; 
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #e0e6ed, #c8d0d8); 
            transition: 0.4s;
            border-radius: 15px; 
            box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.2), 0 3px 6px rgba(0, 0, 0, 0.1); 
        }
        
        .sun svg {
            position: absolute;
            top: 4px;
            left: 24px; 
            z-index: 1;
            width: 14px; 
            height: 14px; 
        }
        
        .moon svg {
            fill: #73C0FC;
            position: absolute;
            top: 4px;
            left: 4px; 
            z-index: 1;
            width: 14px;
            height: 14px; 
        }
        
        input:checked + .slider {
            background: linear-gradient(135deg, #3a3f44, #50575d); 
            box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.5), 0 3px 6px rgba(0, 0, 0, 0.2);
        }
        
        input:checked + .slider:before {
            background-color: #ffffff; 
            transform: translateX(18px);
            box-shadow: 0 3px 4px rgba(0, 0, 0, 0.3); 
        }

        .file-table-container {
            max-height: 200px;
            overflow-y: auto; 
            overflow-x: auto;
            margin: 20px 0;
            border: 1px solid #ccc;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); 
            background: linear-gradient(135deg, #f0f4f8, #e2e8f0);
            width: 100%; 
            margin: 0 auto; 
        }
        
        .file-table {
            width: 100%;
            border-collapse: collapse; 
            text-align: center;
            color: black;
            font-family: 'Arial', sans-serif;
            table-layout: fixed;
            margin: 0;
        }
        
        .file-table th {
            position: sticky;
            top: 0; 
            z-index: 10;
            background: transparent;
            backdrop-filter: blur(7px);
            -webkit-backdrop-filter: blur(7px);
            background: rgba(0, 0, 0, 0.02); 
            color: black; 
            font-weight: bold;
            padding: 10px;
            word-wrap: break-word; 
            white-space: normal;
        }
        
        .file-table td {
            padding: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            color: black;
            overflow: auto; 
            white-space: nowrap; 
            word-wrap: break-word; 
            max-width: 200px;
        }
        
        .file-table td::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: padding-box; 
        }
        
        .file-table td.editable-partition {
            background: #eef7ff; 
            cursor: text;
        }

        .file-table tr.disabled {
            background-color: #dddddd;
        }

        .file-table tr.disabled td.editable-partition {
            background: #dddddd; 
        }

        .file-table tr.disabled:hover {
            background-color: #d8d8d8;
        }
        
        input[type="file"]::-webkit-file-upload-button {
            padding: 3.6px 12px;
            margin-right: 10px;
            border-radius: 10px;
            background-color: #e3e3e3;
            color: #333;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
            font-size: 14px;
        }

        input[type="file"]::-webkit-file-upload-button:hover {
            background-color: #d3d3d3;
            transform: scale(1.03);
        }

        .file-table input[type="checkbox"].row-checkbox {
            background: #e3e3e3;
        }

        .file-table tr.disabled td:nth-child(1)::after {
            color: black;
        }

        .file-table tr.disabled td:nth-child(2)::after {
            color: black;
        }

        .file-table tr.disabled td:nth-child(3)::after {
            color: black;
        }
    </style>
    <style id="dark">
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1c1f24, #18191A);    
            color: #e8eaed;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            min-height: 100vh;
            background-color: #1c1f24;
        }

        h1 {
            color: #4a4a4a;
            text-align: center;
            margin-bottom: 20px;
            font-size: 38px;
            text-shadow: 1px 1px 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #f8f9fa;
            margin-top: 0;
            margin-bottom: 5px;
            font-size: 24px;
            letter-spacing: 2px;
            background: linear-gradient(135deg, #00d1ff, #0052cc);
            -webkit-background-clip: text;
            color: transparent;
            animation: textGlow 4s ease-in-out infinite;
        }

        .subtitle {
            color: #f8f9fa;
            text-align: center;
            font-size: 24px;
            margin-top: -5px;
        }

        @keyframes textGlow {
            0%, 100% {
                text-shadow: 
                    0 0 8px rgba(0, 82, 204, 0.8), 
                    0 0 20px rgba(0, 209, 255, 0.5);
            }
            50% {
                text-shadow: 
                    0 0 16px rgba(0, 82, 204, 0.8), 
                    0 0 30px rgba(0, 209, 255, 0.5);
            }
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; 
            padding: 30px;
            width: 90%;
            max-width: 600px;
            margin: 30px 0;
            background: linear-gradient(135deg, #1c1f24, #3a3f44);
            background-size: 200% 200%; 
            border-radius: 20px;
            position: relative;
            text-align: center;
            overflow: hidden;
            animation: backgroundMove 20s linear infinite; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .container::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #ff6ec4, #7873f5, #3a1c71, #ff6ec4);
            background-size: 400% 400%;
            border-radius: 20px;
            z-index: -1;
            filter: blur(10px);
            opacity: 0.8;
            animation: glow 10s ease infinite;
            box-shadow: 
                0 0 20px 10px rgba(255, 110, 196, 0.5),   
                0 0 40px 10px rgba(255, 110, 196, 0.3) inset,
                -10px -10px 30px rgba(255, 110, 196, 0.8), 
                10px -10px 30px rgba(255, 110, 196, 0.8),  
                -10px 10px 30px rgba(255, 110, 196, 0.8),
                10px 10px 30px rgba(255, 110, 196, 0.8);  
        }
        
        input[type="file"],
        input[type="text"], 
        select {
            text-align: center;
            width: 100%;
            max-width: 600px;
            padding: 15px 20px;
            margin: 10px 0; 
            border-radius: 20px;
            border: none;
            box-sizing: border-box;
            background: linear-gradient(135deg, #333, #444);
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none; 
            background-color: #444;
            font-size: 14px;
            font-weight: bold;
            color: white;
        }
        
        pre.result-field {
            background: linear-gradient(135deg, #333, #444); 
            padding: 20px 20px 20px;
            border-radius: 15px;
            overflow-y: auto; 
            overflow-x: hidden;
            max-height: 200px; 
            border: none;
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
            width: 90%; 
            margin-top: 0; 
            position: relative; 
            color: white;
            white-space: pre-wrap; 
            word-wrap: break-word; 
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #3a3f44, #50575d);
            transition: 0.4s;
            border-radius: 15px;
            box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.5), 0 3px 6px rgba(0, 0, 0, 0.2);
        }
        
        .sun svg {
            position: absolute;
            top: 4px; 
            left: 4px; 
            z-index: 1;
            width: 14px;
            height: 14px;
        }
        
        .moon svg {
            fill: #73C0FC;
            position: absolute;
            top: 4px;
            left: 24px; 
            z-index: 1;
            width: 14px;
            height: 14px; 
        }
        
        input:checked + .slider {
            background: linear-gradient(135deg, #e0e6ed, #c8d0d8);
            box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.2), 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        input:checked + .slider:before {
            background-color: #ffffff; 
            transform: translateX(18px);
            box-shadow: 0 3px 4px rgba(0, 0, 0, 0.2);
        }

        .file-table-container {
            max-height: 200px;
            overflow-y: auto; 
            overflow-x: auto; 
            margin: 20px 0;
            border: none;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, #333, #444); 
            width: 100%; 
            margin: 0 auto; 
        }
        
        .file-table {
            width: 100%; 
            border-collapse: collapse; 
            text-align: center; 
            color: white;
            font-family: 'Arial', sans-serif; 
            table-layout: fixed;
            margin: 0; 
        }
        
        .file-table th {
            position: sticky;
            top: 0;
            z-index: 10;
            background: transparent;
            backdrop-filter: blur(7px);
            -webkit-backdrop-filter: blur(7px);
            background: rgba(0, 0, 0, 0.02); 
            color: white;
            font-weight: bold;
            padding: 10px;
            word-wrap: break-word; 
            white-space: normal;
        }
        
        .file-table td {
            padding: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            color: white;
            overflow: auto; 
            white-space: nowrap;
            word-wrap: break-word; 
            max-width: 200px; 
        }
        
        .file-table td::-webkit-scrollbar-thumb {
            background: #191919; 
            border-radius: 10px; 
            border: 2px solid transparent;
            background-clip: padding-box; 
        }
        
        .file-table td.editable-partition {
            background: #444444; 
            cursor: text; 
        }

        .file-table tr.disabled {
            background-color: #2a2a2a;
        }

        .file-table tr.disabled td.editable-partition {
            background: #2a2a2a; 
        }

        .file-table tr.disabled:hover {
            background-color: #272727;
        }

        input[type="file"]::-webkit-file-upload-button {
            padding: 4px 10px;
            margin-right: 10px;
            border-radius: 10px;
            background-color: #545454;
            color: white;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
            font-size: 14px;
        }

        input[type="file"]::-webkit-file-upload-button:hover {
            background-color: #646464;
            transform: scale(1.03);
        }

        .file-table input[type="checkbox"].row-checkbox {
            background: #292e39;
        }

        .file-table tr.disabled td:nth-child(1)::after {
            color: #fff;
        }

        .file-table tr.disabled td:nth-child(2)::after {
            color: #fff;
        }

        .file-table tr.disabled td:nth-child(3)::after {
            color: #fff;
        }
    </style>
    <style>

        .title {
            text-align: center;
            font-size: 32px;
            letter-spacing: 0.5px;
        }

        .text-gradient {
            background: linear-gradient(135deg, #00d1ff, #0052cc);
            -webkit-background-clip: text;
            color: transparent;
            text-shadow: 
                0 0 5px rgba(0, 209, 255, 0.7), 
                0 0 10px rgba(0, 209, 255, 0.5), 
                0 0 15px rgba(0, 209, 255, 0.3), 
                0 0 20px rgba(0, 209, 255, 0.2);
            animation: textGlow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        @keyframes backgroundMove {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        form {
            display: flex;
            flex-direction: column;
            width: 100%;
            align-items: center;
        }

        .button {
            background: linear-gradient(135deg, #007bff, #00d4ff);
            border: none;
            border-radius: 20px;
            color: white;
            padding: 15px 20px;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 1px 1px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
            margin: 10px 0;
            width: 100%;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3);
            animation: buttonGlow 3s ease-in-out infinite alternate;
        }

        .button:hover {
            background: linear-gradient(135deg, #0869d1, #08ace2);
            transform: scale(1.022);
        }
        
        .button:disabled {
            background: linear-gradient(135deg, #b0b0b0, #d4d4d4);
            color: #888;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        input[type="file"] {
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.05); 
            transition: all 0.3s ease;
            -webkit-appearance: none; 
            -moz-appearance: none;
            appearance: none; 
        }
        
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 12px;
            font-size: 19px;
            text-shadow: 1px 1px 10px rgba(0, 0, 0, 0.1);
        }
        
        .status-field {
            font-weight: bold;
            display: block;
            margin-bottom: 10px;
            margin-top: 1px;
            font-size: 20px;
            text-shadow: 1px 1px 10px rgba(0, 0, 0, 0.1);
        }

        pre.result-field::-webkit-scrollbar {
            width: 12px; 
            background: transparent; 
        }
        
        pre.result-field::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.5); 
            border-radius: 10px; 
            border: 3px solid transparent; 
            background-clip: padding-box; 
            height: 50px;
            margin: 10px 0; 
        }
        
        pre.result-field::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        .switchx {
            font-size: 17px;
            position: absolute;
            top: 7px;
            right: 7px; 
            display: inline-block;
            width: 40px;
            height: 22px;
        }
        
        .switchx input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            border-radius: 50%;
            left: 2px;
            bottom: 2px;
            z-index: 2;
            background-color: #e8e8e8; 
            transition: 0.4s;
            box-shadow: 0 3px 4px rgba(0, 0, 0, 0.3);
        }

        .inputx:focus + .slider {
            box-shadow: 0 0 1px #183153;
        }

        .animated-button img {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        .animated-button:hover img {
            transform: scale(1.1);
            opacity: 0.9; 
        }

        .file-table td::-webkit-scrollbar {
            width: 8px; 
            height: 8px; 
        }
        
        .file-table td::-webkit-scrollbar-track {
            background: transparent;
        }

        .file-table td::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }
        
        .file-table tbody tr:hover {
            background: rgba(0, 0, 0, 0.05);
            cursor: pointer; 
        }

        .file-table-container::-webkit-scrollbar {
            width: 12px;
            background: transparent;
        }
        
        .file-table-container::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            border: 3px solid transparent;
            background-clip: padding-box;
        }
        
        .file-table-container::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.7);
        }
        
        .file-table thead th:first-child {
            border-top-left-radius: 15px;
            border-bottom-left-radius: 15px;
        }

        .file-table thead th:last-child {
            border-top-right-radius: 15px;
            border-bottom-right-radius: 15px;
            width: 18px;
            max-width: 18px;
            padding-right: 12px;
            padding-left: 6px;
        }

        .file-table tbody td:last-child {
            width: 18px;
            max-width: 18px;
            padding-right: 12px;
            padding-left: 6px;
        }

        .file-table input[type="checkbox"].row-checkbox {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        width: 18px;
        height: 18px;
        border: 2px solid #8899a8;
        border-radius: 5px;
        display: inline-block;
        cursor: pointer;
        vertical-align: middle;
        box-sizing: border-box;
        transition: border-color 0.17s, background 0.17s;
        margin: 0;
        position: relative;
        }

        .file-table input[type="checkbox"].row-checkbox:hover,
        .file-table input[type="checkbox"].row-checkbox:focus-visible {
        border-color: #3a90db;
        }

        .file-table input[type="checkbox"].row-checkbox:checked {
        background: #3a90db;
        border-color: #3a90db;
        }

        .file-table input[type="checkbox"].row-checkbox:checked::after {
        content: '';
        position: absolute;
        left: 4.5px;
        top: 1.2px;
        width: 5px;
        height: 10px;
        border: solid #fff;
        border-width: 0 2.5px 2.5px 0;
        transform: rotate(45deg);
        pointer-events: none;
        }

        /* Hide all checkboxes in the table, including header */
        .file-table thead th:nth-last-child(2) {
            border-top-right-radius: 15px;
            border-bottom-right-radius: 15px;
        }

        .file-table thead th:last-child,
        .file-table tbody td:last-child {
            width: 0 !important;
            min-width: 0 !important;
            max-width: 0 !important;
            padding: 0 !important;
            border: none !important;
            overflow: hidden !important;
        }
        /* Hide all checkboxes in the table, including header */

        .file-table tr.disabled {
            position: relative;
        }

        .file-table tr.disabled td {
            position: relative;
        }

        .file-table tr.disabled td::after {
            content: '';
            position: absolute;
            inset: 0;
            backdrop-filter: blur(3.5px);
            -webkit-backdrop-filter: blur(3.5px);
            z-index: 2;
        }

        .file-table tr.disabled td:nth-child(1)::after {
            content: "Click";
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1m;
            font-weight: bold;
            letter-spacing: 0.08em;
        }

        .file-table tr.disabled td:nth-child(2)::after {
            content: " To ";
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            font-weight: bold;
            letter-spacing: 0.08em;
        }

        .file-table tr.disabled td:nth-child(3)::after {
            content: "Enable";
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            font-weight: bold;
            letter-spacing: 0.08em;
        }

        #theme-overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
        z-index: 9999;
        overflow: hidden;
        }

        .ripple-circle {
        position: absolute;
        width: 150px;
        height: 150px;
        border-radius: 50%;
        transform: scale(0);
        background: radial-gradient(circle, rgba(255, 255, 255, 0.5), transparent 70%);
        animation: rippleAnim 0.8s ease-out forwards;
        backdrop-filter: blur(20px);
        opacity: 1;
        pointer-events: none;
        z-index: 9999;
        }

        .toggle-animate {
            animation: jumpAnim 0.5s ease-out;
        }

        @keyframes jumpAnim {
        0% {
            transform: translateY(0);
        }
        50% {
            transform: translateY(-15px);
        }
        100% {
            transform: translateY(0);
        }
        }

        @keyframes rippleAnim {
        to {
            transform: scale(10);
            opacity: 0;
        }
        }

        input[type="file"] {
            padding: 11px 12px;
        }

        input[type="file"]:disabled::-webkit-file-upload-button {
            background-color: #d1d5db;
            color: #888;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <h1 class="title">
        <span class="text-gradient">Web Fastboot Flasher</span>
    </h1>
    <h2 class="subtitle">By °⊥⋊ɹ∀° :)</h2>

    <div class="container">
         <label class="switchx">
            <span class="sun">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <g fill="#ffd43b">
                        <circle r="5" cy="12" cx="12"></circle>
                        <path d="m21 13h-1a1 1 0 0 1 0-2h1a1 1 0 0 1 0 2zm-17 0h-1a1 1 0 0 1 0-2h1a1 1 0 0 1 0 2zm13.66-5.66a1 1 0 0 1 -.66-.29 1 1 0 0 1 0-1.41l.71-.71a1 1 0 1 1 1.41 1.41l-.71.71a1 1 0 0 1 -.75.29zm-12.02 12.02a1 1 0 0 1 -.71-.29 1 1 0 0 1 0-1.41l.71-.66a1 1 0 0 1 1.41 1.41l-.71.71a1 1 0 0 1 -.7.24zm6.36-14.36a1 1 0 0 1 -1-1v-1a1 1 0 0 1 2 0v1a1 1 0 0 1 -1 1zm0 17a1 1 0 0 1 -1-1v-1a1 1 0 0 1 2 0v1a1 1 0 0 1 -1 1zm-5.66-14.66a1 1 0 0 1 -.7-.29l-.71-.71a1 1 0 0 1 1.41-1.41l.71.71a1 1 0 0 1 0 1.41 1 1 0 0 1 -.71.29zm12.02 12.02a1 1 0 0 1 -.7-.29l-.66-.71a1 1 0 0 1 1.36-1.36l.71.71a1 1 0 0 1 0 1.41 1 1 0 0 1 -.71.24z"></path>
                    </g>
                </svg>
            </span>
            <span class="moon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                    <path d="m223.5 32c-123.5 0-223.5 100.3-223.5 224s100 224 223.5 224c60.6 0 115.5-24.2 155.8-63.4 5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6-96.9 0-175.5-78.8-175.5-176 0-65.8 36-123.1 89.3-153.3 6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path>
                </svg>
            </span>
            <input type="checkbox" class="inputx" id="toggle-input">
            <span class="slider"></span>
        </label>
        <p class="status-field">Not connected in Fastboot</p>
        <button class="button connect-button">Connect device Fastboot</button>
    </div>

    <div id="theme-overlay"></div>

    <div class="container">
        <form class="command-form">
            <label for="command">Fastboot Commands</label>
            <input type="text" name="command" class="command-input" placeholder="Enter fastboot command here without 'fastboot'" />
            <input type="submit" value="Send" class="button" />
        </form>
            <button class="button reboot-button">Reboot Device</button>
            <button class="button reboot-bootloader-button">Reboot to Bootloader</button>
            <button class="button reboot-recovery-button">Reboot to Recovery</button>
            <button class="button reboot-fastbootd-button">Reboot to FastbootD</button>
	    <button class="button switchslot-button">Switch slot to other</button>
	<p style="text-align: center; font-style: italic; margin-top: 6px;">
	    <strong>Output logs - Flashing percentage</strong>
	</p>
        <pre class="result-field"></pre>
    </div>

    <div class="container">
        <form class="flash-form">
            <label for="flash-file">Flash any images/Complete ROM 💀</label>
            <input type="file" name="flash-file" id="flash-file" accept=".img,.bin,.elf,.mbn,.zip" multiple />
            <label for="flash-partition">Enter Partition</label>
            <input type="text" name="flash-partition" class="flash-partition" placeholder="Partition like - boot, dtbo, super, vendor_boot, recovery, etc." disabled />
            <div class="file-table-container">
                <table id="file-table" class="file-table">
                    <thead>
                        <tr>
                            <th>File Name</th>
                            <th>Partition</th>
                            <th>Size</th>
                            <th><input type="checkbox" id="select-all-checkbox" class="row-checkbox"/></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <input type="submit" value="Flash" class="button" />
        </form>
        <label for="log-output">Logs:</label>
        <pre id="log-output" class="result-field"></pre>
        <button class="button download-log-button">Download Logs</button>
    </div>

    <div class="container">
        <h2 style="text-align: center;">Support My Journey</h2>
        <p style="text-align: center; font-style: italic; margin-bottom: 10px; margin-top: 10px;">"Your support fuels my passion for creating!"</p>
        <div class="button-container" style="text-align: center;">
            <a href="https://www.buymeacoffee.com/ArKT" target="_blank" class="animated-button">
                <img src="https://raw.githubusercontent.com/ArKT-7/Temp-files/master/assets/buymecoffee.png" alt="Buy Me a Coffee" style="height: 60px; width: 217px; margin-top: 10px; margin-left: 10px; margin-right: 10px;">
            </a>
            <a href="https://www.paypal.me/arkt7" target="_blank" class="animated-button">
                <img src="https://raw.githubusercontent.com/ArKT-7/Temp-files/master/assets/Paypal.png" alt="Donate via PayPal" style="height: 63px; width: 220px; margin-top: 10px; margin-right: 10px; margin-left: 10px;">
            </a>
        </div>
    </div>
    
    <script type="module">
        import * as fastboot from "../dist/fastboot.mjs";
        let device = new fastboot.FastbootDevice();
        window.device = device;

        window.onload = function () {
            const toggleInput = document.getElementById('toggle-input');
            const lightStyle = document.getElementById('light');
            const darkStyle = document.getElementById('dark');
            const overlay = document.getElementById('theme-overlay');
            let currentTheme = 'dark';
            lightStyle.disabled = true;
            darkStyle.disabled = false;
            toggleInput.checked = false;

            toggleInput.addEventListener('change', function () {
                const rect = toggleInput.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                const ripple = document.createElement('div');
                ripple.className = 'ripple-circle';
                ripple.style.left = `${centerX - 75}px`;
                ripple.style.top = `${centerY - 75}px`;
                ripple.style.width = ripple.style.height = '150px';
                ripple.style.transformOrigin = 'center';
                overlay.appendChild(ripple);

                setTimeout(() => {
                    if (currentTheme === 'dark') {
                        lightStyle.disabled = false;
                        darkStyle.disabled = true;
                        currentTheme = 'light';
                    } else {
                        lightStyle.disabled = true;
                        darkStyle.disabled = false;
                        currentTheme = 'dark';
                    }
                }, 200);

                setTimeout(() => {
                    ripple.remove();
                    toggleInput.classList.add('toggle-animate');
                    setTimeout(() => {
                        toggleInput.checked = false;
                        toggleInput.blur();
                        toggleInput.classList.remove('toggle-animate');
                    }, 100);
                }, 500);
            });
        };

        fastboot.setDebugLevel(2);

        function toggleElements(disable) {
        const formElements = document.querySelectorAll("input, button, select");

        if (disable === "all") {
            formElements.forEach(element => element.disabled = true);
        } else if (disable === "all-enable") {
            formElements.forEach(element => element.disabled = false);
        } else {
            formElements.forEach((element) => {
            if (
                !element.classList.contains("connect-button") &&
                !element.classList.contains("download-log-button") &&
                !element.closest(".switchx")
            ) {
                element.disabled = Boolean(disable);
            }
            });
        }
        }

        function clearFormElements() {
            const formElements = document.querySelectorAll("input, button, select, textarea");
            const fileTable = document.querySelector("#file-table tbody");
            fileTable.innerHTML = "";

            formElements.forEach((element) => {
                if (element.tagName === "INPUT" && (element.type === "text" || element.type === "file")) {
                    element.value = "";
                } else if (element.tagName === "SELECT") {
                    element.selectedIndex = 0;
                } else if (element.tagName === "TEXTAREA") {
                    element.value = ""; 
                }
            });
        }

        function scrollToLogs() {
            const resultField = document.querySelector(".result-field");
            if (resultField) {
                const offset = -69;
                const top = resultField.getBoundingClientRect().top + window.pageYOffset;
                window.scrollTo({
                    top: top + offset,
                    behavior: "smooth"
                });
            }
        }

        async function connectDevice() {
            let statusField = document.querySelector(".status-field");
            statusField.textContent = "Connecting...";

            try {
                await device.connect();
            } catch (error) {
                statusField.textContent = `Failed to connect to device: ${error.message}`;
                toggleElements(true); 
                return;
            }

            let product = await device.getVariable("product");
            let slot = await device.getVariable("current-slot");
            let serial = await device.getVariable("serialno");
            let bootloaderStatus = await device.getVariable("unlocked"); 
            let userdata_chk = await device.getVariable("partition-type:userdata");
            let userdata_size = await device.getVariable("partition-size:userdata");
            let bootloaderStatusText = bootloaderStatus === "yes" ? "unlocked" : "locked";

            let status = `Connected to : ${product} <br /> Current slot : ${slot} <br /> (serial : ${serial}) <br />Bootloader status: ${bootloaderStatusText}`;

            let sizeInfo = '';
            if (await checkPartition("userdata", userdata_chk, userdata_size)) {
                sizeInfo += `<p style="margin: 0; margin-top: 5px;">Android Partition : ${getSizeString(userdata_size)}</p>`;
            }
            
            if (sizeInfo) {
                status += `<br />${sizeInfo}`;
            }
            statusField.innerHTML = status;
            toggleElements(false); 
            clearFormElements();
        }
        
        toggleElements(true); 

        function handleDisconnect() {
            let statusField = document.querySelector(".status-field");
            statusField.textContent = "Not connected in Fastboot";
            toggleElements(true); 
        }

        async function checkDeviceConnection() {
            let statusField = document.querySelector(".status-field");

            try {
                let product = await device.getVariable("product");
                if (product) {
                }
            } catch (error) {
                statusField.textContent = "Device disconnected!";
                toggleElements(true);
            }
            clearFormElements();
        }

        async function checkPartition(partitionName, partitionChk, partitionSize) {
            return partitionChk;
        }

        function getSizeString(hex) {
            const size = parseInt(hex, 16);
            const sizeInGB = size / (1024 ** 3);
            const sizeInMB = size / (1024 ** 2);

            if (sizeInGB < 1) {
                return `${sizeInMB.toFixed(2)} MB`;
            }
            return `${sizeInGB.toFixed(2)} GB`;
        }

        async function sendFormCommand(event) {
            event.preventDefault();
            let inputField = document.querySelector(".command-input");
            let command = inputField.value.trim();
            let resultField = document.querySelector(".result-field");

            if (!command) {
                resultField.textContent = "\nPlease enter a command!\n" + resultField.textContent;
                alert("Please enter a command!");
                return;
            }

            try {
                let result = (await device.runCommand(command)).text;
                resultField.textContent = `\nCommand executed successfully: ${result}\n` + resultField.textContent; 
                alert(`Command executed successfully: ${result}`);
            } catch (error) {
                resultField.textContent = `\nError executing command: ${error.message}\n` + resultField.textContent; 
                alert(`Error executing command: ${error.message}`);
            } finally {
                inputField.value = "";
                await checkDeviceConnection();
            }
        }

        async function runRebootCommand(command, successMessage) {
            let resultField = document.querySelector(".result-field");
            try {
                let result = (await device.runCommand(command)).text;
                resultField.textContent = `\n${successMessage}\n` + resultField.textContent;
                alert(successMessage);
            } catch (error) {
                resultField.textContent = `\nError during reboot: ${error.message}\n` + resultField.textContent;
                alert(`Error during reboot: ${error.message}`);
            } finally {
                await checkDeviceConnection();
            }
        }

        async function rebootDevice() {await runRebootCommand("reboot", "Device rebooted successfully!");}
        async function rebootToBootloader() {await runRebootCommand("reboot-bootloader", "Rebooted to Bootloader successfully!");}
        async function rebootToRecovery() {await runRebootCommand("reboot-recovery", "Rebooted to Recovery successfully!");}
        async function rebootToFastbootD() {await runRebootCommand("reboot-fastboot", "Rebooted to FastbootD successfully!");}

        async function switchSlot() {
            let resultField = document.querySelector(".result-field");
            try {
                let activeSlot = (await device.runCommand("getvar:current-slot")).text.trim();
                let otherSlot = activeSlot === "a" ? "b" : "a";
                let result = (await device.runCommand(`set_active:${otherSlot}`)).text;
                resultField.textContent = `\nSwitched to slot ${otherSlot}: ${result}\n` + resultField.textContent;
                alert(`Switched to slot ${otherSlot}: ${result} Successfully`);
                document.querySelector(".connect-button").click();
            } catch (error) {
                resultField.textContent = `\nError switching slots: ${error.message}\n` + resultField.textContent;
                alert(`Error switching slots: ${error.message}`);
            } finally {
                await checkDeviceConnection();
            }
        }

        const fileMapping = {
            "boot.img": "boot_ab",
            "crclist.txt": "crclist",
            "sparsecrclist.txt": "sparsecrclist",
            "sparsecrclist.txt": "sparsecrclist",
            "ksu_boot.img": "boot_ab",
            "ksu-n_boot.img": "boot_ab",
            "magisk_boot.img": "boot_ab",
            "ksu_dtbo.img": "dtbo_ab",
            "ksu-n_dtbo.img": "dtbo_ab",
            "xbl.elf": "xbl_ab",
            "xbl_config.elf": "xbl_config_ab",
            "xbl.img": "xbl_ab",
            "xbl_config.img": "xbl_config_ab",
            "abl.elf": "abl_ab",
            "abl.img": "abl_ab",
            "tz.mbn": "tz_ab",
            "tz.img": "tz_ab",
            "hyp.mbn": "hyp_ab",
            "hyp.img": "hyp_ab",
            "devcfg.mbn": "devcfg_ab",
            "devcfg.img": "devcfg_ab",
            "storsec.mbn": "storsec",
            "storsec.img": "storsec",
            "btfm.bin": "bluetooth_ab",
            "bluetooth.img": "bluetooth_ab",	
            "cmnlib.mbn": "cmnlib_ab",
            "cmnlib64.mbn": "cmnlib64_ab",
            "cmnlib.img": "cmnlib_ab",
            "cmnlib64.img": "cmnlib64_ab",
            "non-hlos.bin": "modem_ab",
            "modem.img": "modem_ab",
            "dspso.bin": "dsp_ab",
            "dsp.img": "dsp_ab",	
            "km41.mbn": "keymaster_ab",
            "keymaster.img": "keymaster_ab",
            "aop.mbn": "aop_ab",
            "aop.img": "aop_ab",	
            "qupv3fw.elf": "qupfw_ab",
            "qupfw.img": "qupfw_ab",
            "imagefv.elf": "imagefv_ab",
            "imagefv.img": "imagefv_ab",
            "uefi_sec.mbn": "uefisecapp_ab",
            "uefisecapp.img": "uefisecapp_ab",
            "multi_image.mbn": "multiimgoem_ab",
            "metadata.img": "metadata",
            "vbmeta_system.img": "vbmeta_system_ab",
            "vbmeta.img": "vbmeta_ab",
            "dtbo.img": "dtbo_ab",
            "userdata.img": "userdata",
            "rescue.img": "rescue",
            "vendor_boot.img": "vendor_boot_ab",
            "cust.img": "cust",
            "fw_4j1ed.img": "fw_4j1ed_ab",
            "fw_4u1ea.img": "fw_4u1ea_ab",
            "LOGO.img": "logo_ab",
            "logo.img": "LOGO_ab",
            "featenabler.img": "featenabler",
            "system.img": "system",
            "system_ext.img": "system_ext",
            "vendor.img": "vendor",
            "odm.img": "odm",
            "product.img": "product",
            "mi_ext.img": "mi_ext",
            "super.img": "super",
            "misc.img": "misc"
        };

        function formatFileSize(size) {
            if (size < 1024) return size + " B";
            if (size < 1024 * 1024) return (size / 1024).toFixed(2) + " KB";
            if (size < 1024 * 1024 * 1024) return (size / (1024 * 1024)).toFixed(2) + " MB";
            return (size / (1024 * 1024 * 1024)).toFixed(2) + " GB";
        }

        function typeAnimation(element, text, delay = 16) {
            element.value = "";
            let i = 0;

            const typeInterval = setInterval(() => {
                element.value += text[i];
                i++;
                if (i === text.length) {
                    clearInterval(typeInterval);
                }
            }, delay);
        }

        let extractedFilesFromZip = [];
        let currentZipReader = null;
        let currentZipEntries = [];

        document.querySelector("#flash-file").addEventListener("change", async function () {
            const fileField = document.querySelector("#flash-file");
            const partField = document.querySelector(".flash-partition");
            const fileTable = document.querySelector("#file-table tbody");
            const selectAllCheckbox = document.getElementById("select-all-checkbox");

            fileTable.innerHTML = "";  // clear table
            extractedFilesFromZip = [];
            currentZipReader = null;
            currentZipEntries = [];

            let filesToShow = [];

            if (fileField.files.length === 0) {
                partField.value = "";
                partField.disabled = true;
                partField.placeholder = "Partition like - boot, dtbo, super, vendor_boot, recovery, etc.";
                updateSelectAllCheckbox();
                return;
            }

            function setPartitionCellEditable(row, editable) {
                const partitionCell = row.querySelector('td.editable-partition');
                if (partitionCell) {
                    partitionCell.setAttribute('contenteditable', editable ? 'true' : 'false');
                }
            }

            function addFileRow(fileName, fileSize, isEditable) {
                const matchedPartition = fileMapping[fileName.toLowerCase()] || null;
                const editable = !matchedPartition;

                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${fileName}</td>
                    <td contenteditable="${editable}" class="${editable ? 'editable-partition' : ''}">
                        ${matchedPartition || "Enter Partition"}
                    </td>
                    <td>${fileSize}</td>
                    <td><input type="checkbox" class="row-checkbox" checked /></td>
                `;
            setPartitionCellEditable(row, true);
            row.addEventListener("click", (e) => {
                if (e.target.classList.contains('row-checkbox')) return;
                if (e.target.closest('td.editable-partition')) return;
                const checkbox = row.querySelector('.row-checkbox');
                checkbox.checked = !checkbox.checked;
                row.classList.toggle('disabled', !checkbox.checked);
                setPartitionCellEditable(row, checkbox.checked);
                updateSelectAllCheckbox();
            });

            row.querySelector('.row-checkbox').addEventListener("change", function () {
                row.classList.toggle('disabled', !this.checked);
                setPartitionCellEditable(row, this.checked);
                updateSelectAllCheckbox();
            });
                fileTable.appendChild(row);
            }

            function updateSelectAllCheckbox() {
                if (!selectAllCheckbox) return;
                const rowCheckboxes = Array.from(fileTable.querySelectorAll(".row-checkbox"))
                    .filter(cb => cb !== selectAllCheckbox);

                if (rowCheckboxes.length === 0) {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                    return;
                }
                const allChecked = rowCheckboxes.every(cb => cb.checked);
                const someChecked = rowCheckboxes.some(cb => cb.checked);
                selectAllCheckbox.checked = allChecked;
                selectAllCheckbox.indeterminate = !allChecked && someChecked;
            }

            if (selectAllCheckbox && !selectAllCheckbox.hasSelectAllListener) {
                selectAllCheckbox.addEventListener("change", () => {
                    const checked = selectAllCheckbox.checked;
                    const rowCheckboxes = Array.from(fileTable.querySelectorAll(".row-checkbox"))
                        .filter(cb => cb !== selectAllCheckbox);
                    rowCheckboxes.forEach(cb => {
                        if (cb.checked !== checked) {
                            cb.checked = checked;
                            cb.dispatchEvent(new Event('change'));
                        }
                    });
                });
                selectAllCheckbox.hasSelectAllListener = true;
            }

            const selectedFiles = Array.from(fileField.files);

            if (selectedFiles.length === 1 && selectedFiles[0].name.toLowerCase().endsWith(".zip")) {
                try {
                    const zipFile = selectedFiles[0];
                    currentZipReader = new zip.ZipReader(new zip.BlobReader(zipFile));
                    currentZipEntries = await currentZipReader.getEntries();

                    const allowedExt = ['img', 'mbn', 'elf', 'bin'];
                    const maxSizeBytes = 9000 * 1024 * 1024; // 9000 MB

                    const filteredEntries = currentZipEntries.filter(e => {
                        const ext = e.filename.split('.').pop().toLowerCase();
                        return allowedExt.includes(ext) && e.uncompressedSize <= maxSizeBytes;
                    });

                    if (filteredEntries.length === 0) {
                        alert("No supported image files smaller than 9000MB found inside the ZIP!");
                        return;
                    }

                    filteredEntries.forEach(entry => {
                        const fileName = entry.filename.split('/').pop();
                        const sizeFormatted = formatFileSize(entry.uncompressedSize || 0);
                        addFileRow(fileName, sizeFormatted, true);
                        filesToShow.push({ name: fileName });
                    });
                    partField.value = "";
                    partField.disabled = true;
                    partField.placeholder = "Enter partition in the table for multiple files";

                } catch (err) {
                    alert("Failed to read ZIP file: " + err.message);
                    return;
                }
            } else {
                selectedFiles.forEach(file => {
                    const fileName = file.name;
                    const sizeFormatted = formatFileSize(file.size);
                    const matchedPartition = fileMapping[fileName.toLowerCase()];
                    const isEditable = !matchedPartition;
                    addFileRow(fileName, sizeFormatted, isEditable);
                    filesToShow.push({ name: fileName, file });
                });

                currentZipReader = null;
                currentZipEntries = [];

                if (selectedFiles.length > 1) {
                    partField.value = "";
                    partField.disabled = true;
                    partField.placeholder = "Enter partition in the table for multiple files";
                } else {
                    partField.value = "";
                    partField.disabled = false;
                    partField.placeholder = "Partition like - boot, dtbo, super, vendor_boot, recovery, etc.";
                }
            }

            if (filesToShow.length === 1) {
                const matchedPartition = fileMapping[filesToShow[0].name.toLowerCase()] || null;
                const firstRow = fileTable.querySelector("tr");
                if (!firstRow) return;
                const partitionCell = firstRow.cells[1];

                if (matchedPartition) {
                    partField.value = "";
                    typeAnimation(partField, matchedPartition, 100);
                } else {
                    partField.value = "";
                    partField.placeholder = "Partition like - boot, dtbo, super, vendor_boot, recovery, etc.";
                }

                partField.oninput = null;
                partitionCell.oninput = null;

                partField.addEventListener("input", (e) => {
                    partitionCell.textContent = e.target.value;
                });
                partitionCell.addEventListener("input", (e) => {
                    partField.value = partitionCell.textContent;
                });
            }
            updateSelectAllCheckbox();
        });


        async function flashFormFile(event) {
            event.preventDefault();
            scrollToLogs(); 
            toggleElements("all"); 

            const fileTable = document.querySelector("#file-table tbody");
            const allRows = fileTable.querySelectorAll("tr");
            const rows = Array.from(allRows).filter(row => row.querySelector('.row-checkbox')?.checked);
            const resultField = document.querySelector(".result-field");
            let slot = await device.getVariable("current-slot");

            if (rows.length === 0) {
                alert("Please select at least one file to flash!");
                toggleElements("all-enable");
                return;
            }

            const partitions = [];
            let hasError = false;

            rows.forEach((row) => {
                let partition = row.cells[1].textContent.trim();

                if ((slot === null || (slot !== "a" && slot !== "b")) && partition.endsWith("_ab")) {
                    partition = partition.replace(/_ab$/, "");
                }

                if (!partition || partition === "Enter Partition" || partition === "Enter Partition in the table for multiple files") {
                    row.cells[1].textContent = "Enter Partition";
                    hasError = true;
                } else {
                    partitions.push(partition);
                }
            });

            if (hasError) {
                alert("Error: Please enter valid partitions for all selected files in the table.");
                resetTableToPlaceholders();
                toggleElements("all-enable");
                return;
            }

            try {
                for (let i = 0; i < rows.length; i++) {
                    const fileName = rows[i].cells[0].textContent;
                    const partition = partitions[i];

                    let fileBlob = null;

                    if (currentZipReader && currentZipEntries.length > 0) {
                        const entry = currentZipEntries.find(e => e.filename.endsWith(fileName));
                        if (!entry) throw new Error(`File ${fileName} not found inside ZIP`);
                        fileBlob = await entry.getData(new zip.BlobWriter());
                    } else {
                        const fileField = document.querySelector("#flash-file");
                        const file = Array.from(fileField.files).find(f => f.name === fileName);
                        if (!file) throw new Error(`File ${fileName} not found in input files`);
                        fileBlob = file;
                    }

                    if (partition.endsWith("_ab")) {
                        const partitionA = partition.replace("_ab", "_a");
                        const partitionB = partition.replace("_ab", "_b");

                        resultField.textContent = `Flashing ${fileName} to ${partitionA}...\n` + resultField.textContent;
                        await device.flashBlob(partitionA, fileBlob, (progress) => {
                            resultField.textContent = `${partitionA} Progress: ${progress}%\n` + resultField.textContent;
                        });
                        resultField.textContent = `Successfully flashed ${fileName} to ${partitionA}.\n` + resultField.textContent;

                        resultField.textContent = `Flashing ${fileName} to ${partitionB}...\n` + resultField.textContent;
                        await device.flashBlob(partitionB, fileBlob, (progress) => {
                            resultField.textContent = `${partitionB} Progress: ${progress}%\n` + resultField.textContent;
                        });
                        resultField.textContent = `Successfully flashed ${fileName} to ${partitionB}.\n` + resultField.textContent;
                    } else {
                        resultField.textContent = `Flashing ${fileName} to ${partition}...\n` + resultField.textContent;
                        await device.flashBlob(partition, fileBlob, (progress) => {
                            resultField.textContent = `${partition} Progress: ${progress}%\n` + resultField.textContent;
                        });
                        resultField.textContent = `Successfully flashed ${fileName} to ${partition}.\n` + resultField.textContent;
                    }
                }

                alert("All files flashed successfully!");
            } catch (error) {
                alert(`Failed to flash: ${error.message}`);
            } finally {
                document.querySelector("#flash-file").value = "";
                const partField = document.querySelector(".flash-partition");
                partField.value = "";
                partField.disabled = true;
                toggleElements("all-enable");
                partField.placeholder = "Partition like - boot, dtbo, super, vendor_boot, recovery, etc.";
                document.querySelector("#file-table tbody").innerHTML = "";
                currentZipReader = null;
                currentZipEntries = [];
                await checkDeviceConnection();
            }
        }

        function resetTableToPlaceholders() {
            const fileTable = document.querySelector("#file-table tbody");
            const rows = fileTable.querySelectorAll("tr");
            rows.forEach(row => {
                const partitionCell = row.cells[1];
                if (!partitionCell.textContent.trim() || partitionCell.textContent.trim() === "Enter Partition") {
                    partitionCell.textContent = "Enter Partition";
                }
            });
        }

        function logdownload() {
            const logOutput = document.getElementById('log-output').textContent.trim();
            if (logOutput === "") {
                alert("Log is empty LOL. Nothing to download! 😂");
                return;
            }
            const blob = new Blob([logOutput], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'arkt_fastboot_tool.log';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        document.querySelector(".connect-button").addEventListener("click", connectDevice);
        document.querySelector(".command-form").addEventListener("submit", sendFormCommand);
        document.querySelector(".reboot-button").addEventListener("click", rebootDevice);
        document.querySelector(".reboot-bootloader-button").addEventListener("click", rebootToBootloader);
        document.querySelector(".reboot-recovery-button").addEventListener("click", rebootToRecovery);
        document.querySelector(".reboot-fastbootd-button").addEventListener("click", rebootToFastbootD);
        document.querySelector(".switchslot-button").addEventListener("click", switchSlot);
        document.querySelector(".flash-form").addEventListener("submit", flashFormFile);
        document.querySelector(".download-log-button").addEventListener("click", logdownload);
    </script>
</body>
</html>